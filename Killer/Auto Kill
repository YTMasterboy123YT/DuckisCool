local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

local autoHitActive = false
local teleportPlayersActive = false

local function autoHit()
    LocalPlayer.muscleEvent:FireServer("punch", "leftHand")
    LocalPlayer.muscleEvent:FireServer("punch", "rightHand")
end

local function teleportPlayers()
    local headPositions = {}
    
    -- First, unanchor all heads
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= LocalPlayer then
            local targetCharacter = otherPlayer.Character
            if targetCharacter and targetCharacter:FindFirstChild("Head") then
                local head = targetCharacter.Head
                head.Anchored = false
                table.insert(headPositions, head) -- Store the head for teleportation
            end
        end
    end
    
    -- Then, teleport all heads to the local player's hand
    local handPosition = LocalPlayer.Character.LeftHand.Position
    for _, head in pairs(headPositions) do
        head.CFrame = CFrame.new(handPosition + Vector3.new(0, 2, 0)) -- Adjust height if necessary
        head.Anchored = true -- Anchor the head after teleporting
    end
end

RunService.Heartbeat:Connect(function()
    if autoHitActive then autoHit() end
    if teleportPlayersActive then teleportPlayers() end
end)

LocalPlayer.Chatted:Connect(function(message)
    if message:lower() == "lol" then
        autoHitActive = true
        teleportPlayersActive = true
    elseif message:lower() == "un" then
        autoHitActive = false
        teleportPlayersActive = false
    end
end)
