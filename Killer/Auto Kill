local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

local autoHitActive = false
local teleportPlayersActive = false
local invisibilityActive = false

local function autoHit()
    LocalPlayer.muscleEvent:FireServer("punch", "leftHand")
    LocalPlayer.muscleEvent:FireServer("punch", "rightHand")
end

local function teleportPlayers()
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= LocalPlayer then
            local targetCharacter = otherPlayer.Character
            if targetCharacter and targetCharacter:FindFirstChild("Head") and LocalPlayer.Character:FindFirstChild("LeftHand") and LocalPlayer.Character:FindFirstChild("RightHand") then
                local targetHead = targetCharacter.Head
                
                -- Anchor the target's hands
                local leftHand = targetCharacter:FindFirstChild("LeftHand")
                local rightHand = targetCharacter:FindFirstChild("RightHand")
                
                if leftHand and rightHand then
                    leftHand.Anchored = true
                    rightHand.Anchored = true
                end
                
                -- Teleport the head to the victim's left and right hands
                targetHead.CFrame = CFrame.new(leftHand.Position) -- or rightHand.Position
            end
        end
    end
end

local function makePlayersHeadsInvisible()
    for _, otherPlayer in pairs(Players:GetPlayers()) do
        if otherPlayer ~= LocalPlayer then
            local targetCharacter = otherPlayer.Character
            if targetCharacter and targetCharacter:FindFirstChild("Head") then
                targetCharacter.Head.Transparency = 1
                -- Optionally, disable any BillboardGuis attached to the head
                for _, descendant in pairs(targetCharacter.Head:GetDescendants()) do
                    if descendant:IsA("BillboardGui") then
                        descendant.Enabled = false
                    end
                end
            end
        end
    end
end

RunService.Heartbeat:Connect(function()
    if autoHitActive then autoHit() end
    if teleportPlayersActive then teleportPlayers() end
    if invisibilityActive then makePlayersHeadsInvisible() end
end)

LocalPlayer.Chatted:Connect(function(message)
    if message:lower() == "lol" then
        autoHitActive = true
        teleportPlayersActive = true
        invisibilityActive = true
    end
end)
